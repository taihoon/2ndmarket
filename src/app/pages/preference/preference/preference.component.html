<ion-header>
  <ion-toolbar>
    <ion-title class="font-bold text-lg text-gay-900 ellipsis">설정</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <div class="h-full flex flex-col justify-between">
    <div class="flex-grow flex flex-col">
      <div>
        <h2 class="flex justify-between">
          <div *ngIf="user$ | async as user" class="p-3 flex items-center">
            <div *ngIf="user" class="w-12 h-12 mr-2 bg-gray-300 text-gray-700 rounded-full flex items-center justify-center text-lg font-bold">
              <img *ngIf="user.photoURL" [src]="user.photoURL" alt='' class="w-full h-full rounded-full object-cover">
              <span *ngIf="!user.photoURL">{{ user | userDisplayName:1 }}</span>
            </div>
            <span class="flex items-center whitespace-no-wrap overflow-hidden flex-shrink flex-grow">
              <span class="block text-sm ellipsis">{{ user | userDisplayName }}</span>
            </span>
            <a routerLink="/preference/user"
              class="flex-shrink-0 mx-2 px-1 flex h-5 items-center text-xs bg-gray-600 text-white">
              프로필 설정
            </a>
          </div>
        </h2>
        <ul *ngIf="counter$ | async as counter"
          class="flex justify-between px-2 h-18">
          <li class="w-1/3 px-1">
            <a routerLink="/preference/messages"
              class="flex flex-col items-center w-full relative border rounded p-2 pb-4">
            <span class="block py-2 text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                  <g fill="none" fill-rule="evenodd">
                    <g stroke="#4A5568" stroke-width="2">
                      <path d="M17.937 23.014C17.533 25.279 15.576 27 13.22 27c-2.33 0-4.27-1.684-4.702-3.915M15.827.29C14.938.041 14.317 0 13.35 0 7.54 0 2.684 4.915 2.684 10.8v8.1L.466 22.95h25.093L23.35 18.9v-4.725" transform="translate(2 2)"/>
                      <g>
                        <path d="M0 0L11 0" transform="translate(2 2) translate(17 1)"/>
                      </g>
                    </g>
                    <path fill="#4A5568" d="M19 7H30V9H19zM19 12H30V14H19z"/>
                  </g>
                </svg>
              </span>
            <span class="text-xs text-gray-700">알림 <strong class="text-green-500">{{ counter.messages }}</strong>개</span>
            <span *ngIf="counter.messages > 0" class="absolute right-0 top-0 w-1 h-1 m-3 rounded-full bg-red-600"></span>
            </a>
          </li>
          <li class="w-1/3 px-1">
            <a routerLink="/preference/products"
              class="flex flex-col items-center w-full relative border rounded p-2 pb-4">
              <span class="block py-2 text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                  <g fill="none" fill-rule="evenodd">
                    <path stroke="#4A5568" stroke-width="2" d="M4 2H28V29H4z"/>
                    <path stroke="#4A5568" stroke-width="2" d="M20 6v6.382l-4-2-4 2V6h8z"/>
                    <path fill="#4A5568" d="M11 1H13V8H11zM19 1H21V8H19z"/>
                    <path fill="#4A5568" d="M3 5H29V7H3z"/>
                    <g stroke="#4A5568" stroke-width="2" transform="translate(16 16)">
                      <circle cx="8" cy="8" r="7" fill="#FFF"/>
                      <path d="M5 7.714L7.727 10 11 6"/>
                    </g>
                  </g>
                </svg>
              </span>
              <span class="text-xs text-gray-700">
                등록상품 <strong class="text-green-500">{{ counter.products }}</strong>개
              </span>
            </a>
          </li>
          <li class="w-1/3 px-1">
            <a routerLink="/preference/favorites"
              class="flex flex-col items-center w-full relative border rounded p-2 pb-4">
              <span class="block py-2 text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32">
                  <defs>
                    <path id="iwhtk05nsa" d="M0 0L30 0 30 26.25 0 26.25z"/>
                  </defs>
                  <g fill="none" fill-rule="evenodd" transform="translate(1 3)">
                    <mask id="hlwh2g979b" fill="#fff">
                      <use xlink:href="#iwhtk05nsa"/>
                    </mask>
                    <path fill="#4A5568" d="M21.527 0c-1.952 0-3.72.648-5.3 1.946-.44.361-.842.769-1.278 1.17-.036-.037-.07-.076-.104-.115C13.085 1.01 10.973.006 8.517.006c-.58 0-1.178.056-1.797.168-1.558.282-2.903 1.009-4.056 2.092C1.324 3.522.477 5.057.144 6.853c-.382 2.072.025 4.05.863 5.952.947 2.16 2.338 4.023 3.942 5.733 2.808 2.988 6.052 5.435 9.557 7.554.174.105.336.158.498.158.162 0 .323-.053.498-.157 1.867-1.119 3.652-2.356 5.354-3.71 2.612-2.079 5-4.373 6.837-7.181 1.187-1.813 2.06-3.753 2.264-5.937.252-2.71-.606-5.035-2.549-6.942-1.273-1.247-2.817-1.985-4.59-2.232-.44-.061-.87-.091-1.29-.091m0 2c.328 0 .67.024 1.013.071 1.375.192 2.51.742 3.466 1.68 1.513 1.484 2.154 3.228 1.958 5.328-.152 1.635-.77 3.233-1.946 5.027-1.5 2.292-3.537 4.425-6.408 6.712-1.46 1.161-3.006 2.248-4.605 3.235-3.43-2.125-6.248-4.381-8.598-6.883-1.67-1.78-2.804-3.423-3.57-5.171-.764-1.731-1-3.297-.728-4.782.256-1.377.885-2.52 1.924-3.494.913-.859 1.91-1.376 3.043-1.581.497-.09.982-.136 1.44-.136 1.87 0 3.45.759 4.82 2.308.057.066.115.131.177.195l1.357 1.399 1.433-1.321c.147-.135.29-.271.432-.405.265-.252.515-.49.76-.69C18.716 2.488 20.035 2 21.526 2" mask="url(#hlwh2g979b)"/>
                  </g>
                </svg>
              </span>
              <span class="text-xs text-gray-700">
                관심상품 <strong class="text-green-500">{{ counter.favorites }}</strong>개
              </span>
            </a>
          </li>
        </ul>
        <div *ngIf="user$ | async as user" class="px-3">
          <h2 class="mt-4 py-2 text-green-800">그룹 전환</h2>
          <ul *ngIf="accounts$ | async as accounts" class="border-t border-b border-gray-300">
            <li
              *ngFor="let account of accounts first as isFirst"
              class="relative h-12 border-gray-300"
              [ngClass]="{'border-t': !isFirst}">
              <button
                *ngIf="account"
                (click)="onClickGroup(account)"
                class="flex justify-between items-center w-full h-full p-0 border-0 bg-transparent text-gray-800">
                <span class="flex-shrink-0 w-8 h-8 mr-2 relative">
                  <div class="w-8 h-8 mr-2 bg-gray-300 text-gray-700 rounded-full flex items-center justify-center text-xs font-bold">
<!--                      <img *ngIf="myProfile.photoURL" [src]="myProfile.photoURL" alt="프로필이미지" class="w-full h-full rounded-full object-cover">-->
                    <span>{{ account.groupName.slice(0, 1).toUpperCase() }}</span>
                  </div>
                  <span *ngIf="account.id === user.uid" class="absolute right-0 top-0 w-1 h-1 -m-px rounded-full bg-red-600"></span>
                </span>
                <span class="flex-grow text-left text-sm ellipsis">{{ account.groupName }}</span>
                <span
                  class="flex-shrink-0 flex-grow-0 mx-2 px-1 flex h-5 items-center text-xs"
                  [ngClass]="{
                    'text-green-700': account.id !== user.uid,
                    'bg-green-500 text-white': account.id === user.uid
                  }">
                    {{ account.email }}
                </span>
              </button>
            </li>
          </ul>
          <a routerLink="/auth/group-select" class="flex justify-center items-center w-full h-12 p-2 bg-green-600 text-white text-center mt-3">그룹추가</a>
        </div>
      </div>
    </div>
    <div class="px-safe mt-20 p-safe-bottom">
      <div class="p-3">
        <button (click)="onClickSignOut()" class="flex justify-center items-center w-full h-12 bg-gray-500 text-white">로그아웃</button>
      </div>
    </div>
  </div>
</ion-content>
